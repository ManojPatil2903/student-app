<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #0a0c10;
      --surface:   #111318;
      --card:      #16191f;
      --border:    #22262e;
      --accent:    #00e5a0;
      --accent2:   #005c41;
      --danger:    #ff4d6d;
      --warn:      #ffb830;
      --text:      #e8eaf0;
      --muted:     #6b7280;
      --radius:    14px;
      --transition: 0.22s cubic-bezier(.4,0,.2,1);
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â”€â”€ Background grid â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image:
        linear-gradient(rgba(0,229,160,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,229,160,.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    /* â”€â”€ Glow orb â”€â”€ */
    body::after {
      content: '';
      position: fixed;
      top: -200px; left: 50%;
      transform: translateX(-50%);
      width: 800px; height: 500px;
      background: radial-gradient(ellipse, rgba(0,229,160,.07) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      position: relative; z-index: 10;
      padding: 28px 40px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      padding-bottom: 20px;
    }

    .logo {
      display: flex; align-items: center; gap: 14px;
    }

    .logo-icon {
      width: 42px; height: 42px;
      background: linear-gradient(135deg, var(--accent), #00bfa0);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      box-shadow: 0 0 20px rgba(0,229,160,.3);
    }

    .logo-text h1 {
      font-family: 'Syne', sans-serif;
      font-size: 20px; font-weight: 800;
      letter-spacing: -.3px;
    }

    .logo-text p {
      font-size: 12px; color: var(--muted);
      letter-spacing: .5px;
      text-transform: uppercase;
    }

    .header-stats {
      display: flex; gap: 24px;
    }

    .stat-pill {
      display: flex; flex-direction: column; align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 18px;
    }

    .stat-pill span:first-child {
      font-family: 'Syne', sans-serif;
      font-size: 22px; font-weight: 700;
      color: var(--accent);
      line-height: 1;
    }

    .stat-pill span:last-child {
      font-size: 11px; color: var(--muted);
      text-transform: uppercase; letter-spacing: .5px;
    }

    /* â”€â”€ MAIN LAYOUT â”€â”€ */
    .layout {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 0;
      min-height: calc(100vh - 90px);
    }

    /* â”€â”€ SIDEBAR (FORM) â”€â”€ */
    .sidebar {
      border-right: 1px solid var(--border);
      padding: 28px 28px;
      display: flex; flex-direction: column; gap: 24px;
      position: sticky; top: 0;
      height: calc(100vh - 90px);
      overflow-y: auto;
    }

    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .form-header {
      display: flex; align-items: center; justify-content: space-between;
    }

    .form-title {
      font-family: 'Syne', sans-serif;
      font-size: 16px; font-weight: 700;
    }

    .mode-badge {
      font-size: 11px; font-weight: 600;
      padding: 4px 10px; border-radius: 20px;
      letter-spacing: .5px; text-transform: uppercase;
      background: rgba(0,229,160,.12);
      color: var(--accent);
      border: 1px solid rgba(0,229,160,.2);
      transition: var(--transition);
    }

    .mode-badge.edit {
      background: rgba(255,184,48,.12);
      color: var(--warn);
      border-color: rgba(255,184,48,.2);
    }

    /* Form fields */
    .field {
      display: flex; flex-direction: column; gap: 7px;
    }

    .field label {
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .6px;
    }

    .field label span {
      color: var(--accent);
    }

    .field input {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14.5px;
      padding: 11px 14px;
      width: 100%;
      outline: none;
      transition: var(--transition);
    }

    .field input::placeholder { color: #3a3f4a; }

    .field input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,229,160,.1);
    }

    .field input.error {
      border-color: var(--danger);
      box-shadow: 0 0 0 3px rgba(255,77,109,.1);
    }

    .field-error {
      font-size: 12px;
      color: var(--danger);
      display: none;
    }

    .field-error.show { display: block; }

    /* Buttons */
    .btn-group {
      display: flex; gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 12px 16px;
      border-radius: 10px;
      font-family: 'Syne', sans-serif;
      font-size: 14px; font-weight: 600;
      cursor: pointer;
      border: none;
      display: flex; align-items: center; justify-content: center; gap: 7px;
      transition: var(--transition);
      letter-spacing: .2px;
    }

    .btn-primary {
      background: var(--accent);
      color: #041a12;
    }

    .btn-primary:hover {
      background: #00ffb3;
      box-shadow: 0 4px 20px rgba(0,229,160,.3);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-danger {
      background: rgba(255,77,109,.1);
      color: var(--danger);
      border: 1px solid rgba(255,77,109,.2);
    }

    .btn-danger:hover {
      background: var(--danger);
      color: white;
      box-shadow: 0 4px 20px rgba(255,77,109,.3);
    }

    /* â”€â”€ MAIN CONTENT â”€â”€ */
    .main {
      padding: 28px 32px;
      display: flex; flex-direction: column; gap: 20px;
    }

    /* Toolbar */
    .toolbar {
      display: flex; align-items: center; gap: 12px;
    }

    .search-wrap {
      position: relative; flex: 1;
    }

    .search-wrap svg {
      position: absolute;
      left: 14px; top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
    }

    .search-wrap input {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      padding: 11px 14px 11px 42px;
      outline: none;
      transition: var(--transition);
    }

    .search-wrap input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,229,160,.1);
    }

    .search-wrap input::placeholder { color: #3a3f4a; }

    /* â”€â”€ TABLE â”€â”€ */
    .table-wrap {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    table {
      width: 100%; border-collapse: collapse;
    }

    thead {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }

    thead th {
      padding: 13px 16px;
      text-align: left;
      font-family: 'Syne', sans-serif;
      font-size: 11px; font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .8px;
      white-space: nowrap;
    }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background var(--transition);
      animation: rowIn 0.3s ease both;
    }

    @keyframes rowIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    tbody tr:last-child { border-bottom: none; }

    tbody tr:hover { background: rgba(255,255,255,.025); }

    tbody td {
      padding: 14px 16px;
      font-size: 14px;
      vertical-align: middle;
    }

    .td-rollno {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      color: var(--accent);
      font-size: 13px;
    }

    .td-name { font-weight: 500; }

    .td-phone, .td-address {
      color: var(--muted);
      font-size: 13px;
    }

    .td-address {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Avatar */
    .avatar {
      width: 34px; height: 34px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent2), #004d38);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Syne', sans-serif;
      font-size: 13px; font-weight: 700;
      color: var(--accent);
      border: 1.5px solid rgba(0,229,160,.2);
      flex-shrink: 0;
    }

    .name-cell {
      display: flex; align-items: center; gap: 10px;
    }

    /* Action buttons */
    .actions {
      display: flex; gap: 6px;
    }

    .icon-btn {
      width: 32px; height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: var(--transition);
      color: var(--muted);
    }

    .icon-btn:hover.edit-btn {
      background: rgba(255,184,48,.1);
      border-color: rgba(255,184,48,.3);
      color: var(--warn);
    }

    .icon-btn:hover.del-btn {
      background: rgba(255,77,109,.1);
      border-color: rgba(255,77,109,.3);
      color: var(--danger);
    }

    /* Empty state */
    .empty-state {
      padding: 64px 20px;
      display: flex; flex-direction: column; align-items: center; gap: 12px;
      color: var(--muted);
    }

    .empty-state .empty-icon {
      font-size: 48px;
      filter: grayscale(1);
      opacity: .4;
    }

    .empty-state p { font-size: 14px; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast-container {
      position: fixed;
      bottom: 24px; right: 24px;
      z-index: 1000;
      display: flex; flex-direction: column; gap: 8px;
    }

    .toast {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 13.5px; font-weight: 500;
      min-width: 220px;
      animation: toastIn .3s ease;
      border: 1px solid;
    }

    @keyframes toastIn {
      from { opacity: 0; transform: translateX(20px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    .toast.success {
      background: #071a12;
      border-color: rgba(0,229,160,.3);
      color: var(--accent);
    }

    .toast.error {
      background: #1a070a;
      border-color: rgba(255,77,109,.3);
      color: var(--danger);
    }

    .toast.info {
      background: #131a07;
      border-color: rgba(255,184,48,.3);
      color: var(--warn);
    }

    /* â”€â”€ MODAL â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed; inset: 0; z-index: 500;
      background: rgba(0,0,0,.65);
      backdrop-filter: blur(4px);
      align-items: center; justify-content: center;
    }

    .modal-overlay.show { display: flex; }

    .modal {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      max-width: 380px; width: 90%;
      animation: modalIn .25s ease;
    }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(.95); }
      to   { opacity: 1; transform: scale(1); }
    }

    .modal h3 {
      font-family: 'Syne', sans-serif;
      font-size: 18px; font-weight: 700;
      margin-bottom: 8px;
    }

    .modal p {
      color: var(--muted); font-size: 14px;
      line-height: 1.6; margin-bottom: 22px;
    }

    .modal p strong { color: var(--text); }

    .modal-actions { display: flex; gap: 10px; }

    /* Loading spinner */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,.2);
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin .6s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* Responsive */
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { height: auto; position: static; border-right: none; border-bottom: 1px solid var(--border); }
      header { padding: 20px; }
      .header-stats { display: none; }
      .main { padding: 20px; }
    }

    /* Highlight row being edited */
    tr.editing-row { background: rgba(255,184,48,.04) !important; }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ğŸ“</div>
    <div class="logo-text">
      <h1>EduTrack</h1>
      <p>Student Management System</p>
    </div>
  </div>
  <div class="header-stats">
    <div class="stat-pill">
      <span id="totalCount">0</span>
      <span>Students</span>
    </div>
  </div>
</header>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR: FORM -->
  <aside class="sidebar">
    <div class="form-header">
      <span class="form-title" id="formTitle">Add Student</span>
      <span class="mode-badge" id="modeBadge">New</span>
    </div>

    <div class="field">
      <label>Roll No <span>*</span></label>
      <input type="text" id="rollNo" placeholder="e.g. CS101" />
      <span class="field-error" id="rollNoErr">Roll number is required</span>
    </div>

    <div class="field">
      <label>Full Name <span>*</span></label>
      <input type="text" id="name" placeholder="e.g. John Doe" />
      <span class="field-error" id="nameErr">Name is required</span>
    </div>

    <div class="field">
      <label>Address <span>*</span></label>
      <input type="text" id="address" placeholder="e.g. 123 Main St, Mumbai" />
      <span class="field-error" id="addressErr">Address is required</span>
    </div>

    <div class="field">
      <label>Phone Number <span>*</span></label>
      <input type="text" id="phoneNumber" placeholder="10-digit number" maxlength="10" />
      <span class="field-error" id="phoneErr">Enter a valid 10-digit number</span>
    </div>

    <div class="field">
      <label>Email</label>
      <input type="email" id="email" placeholder="e.g. john@email.com" />
      <span class="field-error" id="emailErr">Enter a valid email</span>
    </div>

    <div class="btn-group">
      <button class="btn btn-primary" onclick="submitForm()">
        <span id="submitIcon">ï¼‹</span>
        <span id="submitLabel">Add Student</span>
      </button>
      <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
    </div>

    <!-- Edit-mode cancel -->
    <button class="btn btn-danger" id="cancelEditBtn" style="display:none" onclick="cancelEdit()">
      âœ• Cancel Edit
    </button>
  </aside>

  <!-- MAIN: TABLE -->
  <main class="main">
    <div class="toolbar">
      <div class="search-wrap">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="searchInput" placeholder="Search by nameâ€¦" oninput="handleSearch(this.value)" />
      </div>
      <button class="btn btn-secondary" style="white-space:nowrap;flex:none" onclick="loadStudents()">
        â†º Refresh
      </button>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Roll No</th>
            <th>Student</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentTable">
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-icon">ğŸ“š</div>
                <p>Loading studentsâ€¦</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<!-- DELETE CONFIRMATION MODAL -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <h3>Delete Student?</h3>
    <p>You're about to delete <strong id="deleteStudentName">this student</strong>. This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn btn-danger" onclick="confirmDelete()">Yes, Delete</button>
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<script>
  const API = '/api/students';
  let allStudents = [];
  let editingId = null;
  let deleteTargetId = null;

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('DOMContentLoaded', loadStudents);

  // â”€â”€ LOAD ALL STUDENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadStudents() {
    try {
      const res = await fetch(API);
      if (!res.ok) throw new Error();
      allStudents = await res.json();
      renderTable(allStudents);
      document.getElementById('totalCount').textContent = allStudents.length;
    } catch {
      renderEmpty('Could not connect to server.');
    }
  }

  // â”€â”€ RENDER TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderTable(students) {
    const tbody = document.getElementById('studentTable');
    if (!students.length) {
      tbody.innerHTML = `
        <tr><td colspan="7">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <p>No students found. Add your first student!</p>
          </div>
        </td></tr>`;
      return;
    }

    tbody.innerHTML = students.map((s, i) => `
      <tr id="row-${s.id}" class="${editingId === s.id ? 'editing-row' : ''}"
          style="animation-delay:${i * 0.04}s">
        <td style="color:var(--muted);font-size:12px">${i + 1}</td>
        <td><span class="td-rollno">${esc(s.rollNo)}</span></td>
        <td>
          <div class="name-cell">
            <div class="avatar">${initials(s.name)}</div>
            <span class="td-name">${esc(s.name)}</span>
          </div>
        </td>
        <td class="td-phone">${esc(s.phoneNumber)}</td>
        <td class="td-address" title="${esc(s.address)}">${esc(s.address)}</td>
        <td class="td-phone">${esc(s.email || 'â€”')}</td>
        <td>
          <div class="actions">
            <button class="icon-btn edit-btn" title="Edit" onclick="editStudent(${s.id})">
              âœ
            </button>
            <button class="icon-btn del-btn" title="Delete" onclick="promptDelete(${s.id}, '${esc(s.name)}')">
              âœ•
            </button>
          </div>
        </td>
      </tr>
    `).join('');
  }

  // â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function handleSearch(val) {
    const q = val.trim().toLowerCase();
    renderTable(q ? allStudents.filter(s => s.name.toLowerCase().includes(q)) : allStudents);
  }

  // â”€â”€ SUBMIT (ADD or UPDATE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function submitForm() {
    if (!validateForm()) return;

    const payload = {
      rollNo:      v('rollNo'),
      name:        v('name'),
      address:     v('address'),
      phoneNumber: v('phoneNumber'),
      email:       v('email') || null,
    };

    const btn = document.querySelector('.btn-primary');
    btn.innerHTML = '<div class="spinner"></div>';
    btn.disabled = true;

    try {
      let res;
      if (editingId) {
        res = await fetch(`${API}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      } else {
        res = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      }

      if (res.ok) {
        showToast(editingId ? 'âœ“ Student updated!' : 'âœ“ Student added!', 'success');
        resetForm();
        await loadStudents();
      } else {
        const msg = await res.text();
        showToast('âš  ' + msg, 'error');
      }
    } catch {
      showToast('âš  Server connection failed', 'error');
    } finally {
      btn.innerHTML = `<span id="submitIcon">ï¼‹</span><span id="submitLabel">Add Student</span>`;
      btn.disabled = false;
    }
  }

  // â”€â”€ EDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function editStudent(id) {
    const s = allStudents.find(s => s.id === id);
    if (!s) return;

    editingId = id;
    set('rollNo', s.rollNo);
    set('name', s.name);
    set('address', s.address);
    set('phoneNumber', s.phoneNumber);
    set('email', s.email || '');

    document.getElementById('rollNo').disabled = true;
    document.getElementById('formTitle').textContent = 'Edit Student';
    document.getElementById('modeBadge').textContent = 'Editing';
    document.getElementById('modeBadge').classList.add('edit');
    document.getElementById('submitIcon').textContent = 'âœ';
    document.getElementById('submitLabel').textContent = 'Update Student';
    document.getElementById('cancelEditBtn').style.display = 'block';

    renderTable(allStudents); // Re-render to highlight editing row
    document.querySelector('.sidebar').scrollIntoView({ behavior: 'smooth' });
    showToast('â„¹ Editing ' + s.name, 'info');
  }

  function cancelEdit() {
    resetForm();
    showToast('Edit cancelled', 'info');
  }

  // â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function promptDelete(id, name) {
    deleteTargetId = id;
    document.getElementById('deleteStudentName').textContent = name;
    document.getElementById('deleteModal').classList.add('show');
  }

  async function confirmDelete() {
    closeModal();
    try {
      const res = await fetch(`${API}/${deleteTargetId}`, { method: 'DELETE' });
      if (res.ok) {
        showToast('âœ“ Student deleted', 'success');
        await loadStudents();
        if (editingId === deleteTargetId) resetForm();
      } else {
        showToast('âš  Delete failed', 'error');
      }
    } catch {
      showToast('âš  Server connection failed', 'error');
    }
  }

  function closeModal() {
    document.getElementById('deleteModal').classList.remove('show');
    deleteTargetId = null;
  }

  // â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function resetForm() {
    editingId = null;
    ['rollNo','name','address','phoneNumber','email'].forEach(id => {
      set(id, '');
      document.getElementById(id).classList.remove('error');
      document.getElementById(id).disabled = false;
    });
    clearErrors();

    document.getElementById('formTitle').textContent = 'Add Student';
    document.getElementById('modeBadge').textContent = 'New';
    document.getElementById('modeBadge').classList.remove('edit');
    document.getElementById('submitIcon').textContent = 'ï¼‹';
    document.getElementById('submitLabel').textContent = 'Add Student';
    document.getElementById('cancelEditBtn').style.display = 'none';

    renderTable(allStudents);
  }

  // â”€â”€ VALIDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function validateForm() {
    clearErrors();
    let ok = true;

    if (!v('rollNo')) { showErr('rollNo','rollNoErr'); ok = false; }
    if (!v('name') || v('name').length < 2) { showErr('name','nameErr'); ok = false; }
    if (!v('address')) { showErr('address','addressErr'); ok = false; }
    if (!/^\d{10}$/.test(v('phoneNumber'))) { showErr('phoneNumber','phoneErr'); ok = false; }
    if (v('email') && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v('email'))) {
      showErr('email','emailErr'); ok = false;
    }
    return ok;
  }

  function showErr(inputId, errId) {
    document.getElementById(inputId).classList.add('error');
    document.getElementById(errId).classList.add('show');
  }

  function clearErrors() {
    ['rollNo','name','address','phoneNumber','email'].forEach(id => {
      document.getElementById(id).classList.remove('error');
    });
    ['rollNoErr','nameErr','addressErr','phoneErr','emailErr'].forEach(id => {
      document.getElementById(id).classList.remove('show');
    });
  }

  // â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showToast(msg, type = 'success') {
    const el = document.createElement('div');
    el.className = `toast ${type}`;
    el.textContent = msg;
    document.getElementById('toastContainer').appendChild(el);
    setTimeout(() => el.remove(), 3200);
  }

  // â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const v   = id => document.getElementById(id).value.trim();
  const set = (id, val) => document.getElementById(id).value = val;
  const esc = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  const initials = name => name.split(' ').map(w => w[0]).slice(0,2).join('').toUpperCase();

  function renderEmpty(msg) {
    document.getElementById('studentTable').innerHTML = `
      <tr><td colspan="7">
        <div class="empty-state">
          <div class="empty-icon">âš ï¸</div>
          <p>${msg}</p>
        </div>
      </td></tr>`;
  }

  // Close modal on overlay click
  document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });
</script>
</body>
</html>
